(function(){"use strict";const P=e=>typeof e.prev=="function"?e.prev:P(e.prev);var M=(e,t,n)=>{const r=t[e][n];return r===void 0?t[n]:P(r)};class T{constructor(t,n,r){this.data={id:t,func:(i,...l)=>r(i,typeof this.prev=="function"?this.prev:this.prev.data.func,l)},this.prev=n}}var O=(e,t,n,r)=>{const i=e[r][t];if(i.data.id===n){if(typeof i.prev=="function"){e[t]=i.prev,delete e[r][t];return}e[r][t]=i.prev,e[t]=i.prev.data.func;return}const l=s=>s&&typeof s.prev=="object"?(s.data=s.prev.data,s.prev=s.prev.prev,l(s.prev)):!0,h=s=>{if(!s)throw new Error("could not find unpatch");return typeof s.prev=="object"&&s.data.id!==n?h(s.prev):l(s)};let d=Object.assign({},i);h(d),e[r][t]=d,e[t]=d.data.func},b=function(e,t,n,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(e,n):i?i.value=n:t.set(e,n),n},a=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},m,o,p,g;class k{constructor(t="simian"){m.add(this),o.set(this,void 0),p.set(this,void 0),b(this,o,Symbol(t),"f"),b(this,p,new Set,"f"),this.after=a(this,m,"m",g).call(this,"AFTER"),this.before=a(this,m,"m",g).call(this,"BEFORE"),this.instead=a(this,m,"m",g).call(this,"INSTEAD")}cleanupAll(){for(const t of a(this,p,"f")){for(const n in t[a(this,o,"f")]){const r=M(a(this,o,"f"),t,n);t[n]=r,t[a(this,o,"f")][n]=void 0}t[a(this,o,"f")]=void 0,delete t[a(this,o,"f")]}a(this,p,"f").clear()}}o=new WeakMap,p=new WeakMap,m=new WeakSet,g=function(t){return(n,r,i)=>{const l=r[n];if(typeof l!="function")throw new Error(`${n} is not a function on ${r}`);const h=Symbol();r[a(this,o,"f")]===void 0&&(r[a(this,o,"f")]={});let d;switch(t){case"AFTER":d=(c,w,u)=>{let f=w.apply(c,u);const y=i.apply(c,[u,f]);return typeof y!="undefined"&&(f=y),f};break;case"BEFORE":d=(c,w,u)=>{var f;let y=u;const F=(f=i.apply(c,[u]))!==null&&f!==void 0?f:u;return Array.isArray(F)&&(y=F),w.apply(c,y)};break;case"INSTEAD":d=(c,w,u)=>i.apply(c,[u,w.bind(c)]);break}let s=r[a(this,o,"f")][n];return s===void 0?s=new T(h,l,d):s=new T(h,s,d),r[a(this,o,"f")][n]=s,r[n]=function(){return s.data.func(this,...arguments)},Object.assign(r[n],l),a(this,p,"f").add(r),()=>O(r,n,h,a(this,o,"f"))}};const v=cumcord.modules.webpackModules;v.findByDisplayName("Switch"),v.findByDisplayName("Text"),v.findByDisplayName("Header"),v.findByDisplayName("SwitchItem");const _=cumcord.modules.webpackModules;_.findByDisplayName("FormTitle"),_.findByDisplayName("FormDivider"),_.findByDisplayName("FormSection");const A=cumcord.modules.webpackModules.findByProps("getElementFromMessageId").getElementFromMessageId,C=cumcord.modules.webpack.find(e=>e.dispatch&&!e.getCurrentUser),I=Object.getPrototypeOf(cumcord.modules.webpackModules.findByProps("getChannel")).getChannel,G=Object.getPrototypeOf(cumcord.modules.webpackModules.findByProps("getGuild")).getGuild;cumcord.modules.webpackModules.findByDisplayName("SettingsView");let R=new k,E=[],S,B,D;function H(){for(let e of E)try{document.getElementById(e.id).classList.contains("deleted-message")||document.getElementById(e.id).classList.add("deleted-message")}catch(t){}}var L={onLoad(){window.betterMessageDeletion_enableToasts=!1,D=cumcord.patcher.injectCSS(".deleted-message{background-color: rgba(240, 71, 71, 0.1);}"),B=setInterval(H,300),S=R.instead("dispatch",C,(e,t)=>{if(e[0].type==="MESSAGE_DELETE"){console.log(e);try{var n={deletedHtmlElement:A(document,e[0].id)};if(n.deletedText=n.deletedHtmlElement.innerText.split(`
`)[3],n.id="chat-messages-"+e[0].id,n.deletedHtmlElement,console.log("[messagedeletion] New Deleted Message: "+n.deletedText),E.indexOf(n)==-1&&E.push(n),window.betterMessageDeletion_enableToasts){var r=G(I(e[0].channelId).guild_id).name;cumcord.ui.toasts.showToast({title:`New deleted message in ${r}!`,duration:3e3})}console.log(E);return}catch(i){console.log("[messagedeletion] Failed to get deleted message!"),console.error(i)}}return t(...e)})},onUnload(){D(),S(),clearInterval(B)}};return L})();
